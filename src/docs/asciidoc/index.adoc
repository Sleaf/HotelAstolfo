= アストルフォ ホテル管理システム
九条涼果 <s1131234@gmail.com>
:Author:    九条涼果
:Email:     s1131234@gmail.com
:Date:      AlternativeWayToSetOptional date
:Revision:  0.0.1

阿福旅馆，默认运行在 +http://localhost:80+ 下


Author is {myname}

ifndef::snippets[]
:snippets: ../../../target/snippets
endif::[]

.request
include::{snippets}/home/http-request.adoc[]

.response
include::{snippets}/home/http-response.adoc[]

As you can see the format is very simple, and in fact you always get the same message.

include::{snippets}/home/http-request.adoc[]


https://jsonschema.net/[JSON to JSON Schema生成工具]

http://brutusin.org/json-forms/[JSON Schema to HTML form生成工具]



.Optional Title

Usual
paragraph.



== 注册

. 普通用户

昵称域是可选的。如果密码不是SHA256加密后的(256位长度)会在后台加密保存
请求格式不正确就是400

[source,http]
----
POST http://localhost:10080/api/users/make
Content-Type: application/json

{
  "phoneNumber": "18834321240",
  "password": "abc",
  "nickname": "temp"
}
----

. 前台、管理员

只要修改role就能控制用户权限
[source,http]
----
POST http://localhost:10080/api/users/make
Content-Type: application/json

{
  "phoneNumber": "18811111111",
  "password": "2333",
  "nickname": "我是前台",
  "role": "前台"
}
----

== 登录
需要提供手机号和密码
正确的话 200 并返回用户信息
错误的话 400
在这之后有权限的操作都需要加上HTTP Basic认证
[source,http]
----
POST http://localhost:10080/api/users/login
Content-Type: application/json

{
  "phoneNumber": "18834321240",
  "password": "abc"
}
----


== 用户信息

. 查询绑定的身份证

----
GET http://localhost:10080/api/users/guests?phone=18834321240
Authorization:Basic dGVzdDoyMzMz
----

. 添加身份证

身份证从这生成 http://www.welefen.com/lab/identify/

姓名从这里生成 https://uinames.com/
----
POST http://localhost:10080/api/users/guests?phone=18834321240
Content-Type: application/json
Authorization:Basic dGVzdDoyMzMz

{
  "identification":"130622199901017537",
  "name":"宋娘"
}
----
. 用户的订单

使用手机号参数
----
GET http://localhost:10080/api/users/transactions?phone=18834321240
Authorization:Basic dGVzdDoyMzMz
----

. 更新用户信息

修改密码，修改昵称什么的。因为有Authorization Header，不需要提供原始密码

不过如果头部密码不正确 返回422
----
PUT http://localhost:10080/api/users/18834321239
Content-Type: application/json
Authorization:Basic dGVzdDoyMzMz

{
  "password": "new_pass",
  "nickname": "new_nick"
}
----

== 添加房间

=== 添加房间类型

添加房间类型定义,重复返回409。限制为只有管理员经理才能操作
----
POST http://localhost:10080/api/rooms/addType
Content-Type: application/json
Authorization:Basic dGVzdDoyMzMz

{
  "type": "大床房",
  "description": "足够两个人唑在一起的大小"
}

----
=== 添加房间朝向

添加房间朝向定义
----
POST http://localhost:10080/api/rooms/addDirection
Content-Type: application/json
Authorization:Basic dGVzdDoyMzMz

{
  "type": "东",
  "description": "冬暖夏狼"
}

----
=== 添加房间定义

----
POST http://localhost:10080/api/restful/rooms
Content-Type: application/json

{
  "type":"大床房",
  "direction":"东",
  "specialty":"一个介绍",
  "price":"123",
  "floor":"1",
  "number":"2"
}
----

== 查询房间

提供的关键词有

from 何时入住

to 何时离店

type 房间类型

direction 房间朝向

priceFrom 价格起点，包含

priceTo [priceFrom, priceTo]区间

floor 房间楼层

number 楼层内的第几个房间

都是可选的，不传就是列出全部。不带分页

----
GET http://localhost:10080/api/rooms/list?type=大床房
----
房价大于等于100元的全部

    GET http://localhost:10080/api/rooms/list?priceFrom=100

[99, 100]元范围

    GET http://localhost:10080/api/rooms/list?priceFrom=99&priceTo=100

== 用户预订

所有订单都是预定，区别在于activited（生效）属性和used（来店入住）属性


这个还没完成

.用户创建订单
[source,http]
----
POST http://localhost:10080/api/transactions/make
Content-Type: application/json

{
  "dateFrom": "2017-12-22T16:57:10",
  "dateTo": "2017-12-23T16:57:10",
  "user": "
}
----
